"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[3211],{3905:(e,t,o)=>{o.d(t,{Zo:()=>c,kt:()=>m});var a=o(7294);function n(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function r(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,a)}return o}function i(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?r(Object(o),!0).forEach((function(t){n(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):r(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function l(e,t){if(null==e)return{};var o,a,n=function(e,t){if(null==e)return{};var o,a,n={},r=Object.keys(e);for(a=0;a<r.length;a++)o=r[a],t.indexOf(o)>=0||(n[o]=e[o]);return n}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)o=r[a],t.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(n[o]=e[o])}return n}var s=a.createContext({}),d=function(e){var t=a.useContext(s),o=t;return e&&(o="function"==typeof e?e(t):i(i({},t),e)),o},c=function(e){var t=d(e.components);return a.createElement(s.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},p=a.forwardRef((function(e,t){var o=e.components,n=e.mdxType,r=e.originalType,s=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),p=d(o),m=n,h=p["".concat(s,".").concat(m)]||p[m]||u[m]||r;return o?a.createElement(h,i(i({ref:t},c),{},{components:o})):a.createElement(h,i({ref:t},c))}));function m(e,t){var o=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var r=o.length,i=new Array(r);i[0]=p;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:n,i[1]=l;for(var d=2;d<r;d++)i[d]=o[d];return a.createElement.apply(null,i)}return a.createElement.apply(null,o)}p.displayName="MDXCreateElement"},1150:(e,t,o)=>{o.r(t),o.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>u,frontMatter:()=>r,metadata:()=>l,toc:()=>d});var a=o(7462),n=(o(7294),o(3905));const r={sidebar_position:8,sidebar_label:"FAQs"},i="FAQs",l={unversionedId:"faqs",id:"faqs",title:"FAQs",description:"Q1: How does HwameiStor scheduler work in a Kubernetes platform?",source:"@site/docs/faqs.md",sourceDirName:".",slug:"/faqs",permalink:"/docs/faqs",draft:!1,editUrl:"https://github.com/hwameistor/hwameistor/docs/faqs.md",tags:[],version:"current",sidebarPosition:8,frontMatter:{sidebar_position:8,sidebar_label:"FAQs"},sidebar:"tutorialSidebar",previous:{title:"Community",permalink:"/docs/community"}},s={},d=[{value:"Q1: How does HwameiStor scheduler work in a Kubernetes platform?",id:"q1-how-does-hwameistor-scheduler-work-in-a-kubernetes-platform",level:2},{value:"Q2: How does HwameiStor schedule applications with multi-replicas workloads and what are the differences compared to the traditional shared storage (NFS / block)?",id:"q2-how-does-hwameistor-schedule-applications-with-multi-replicas-workloads-and-what-are-the-differences-compared-to-the-traditional-shared-storage-nfs--block",level:2},{value:"Q3: How to maintain a Kubernetes node?",id:"q3-how-to-maintain-a-kubernetes-node",level:2},{value:"Retire a node",id:"retire-a-node",level:3},{value:"Reboot a node",id:"reboot-a-node",level:3},{value:"For the traditional shared storage:",id:"for-the-traditional-shared-storage",level:3}],c={toc:d};function u(e){let{components:t,...r}=e;return(0,n.kt)("wrapper",(0,a.Z)({},c,r,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("h1",{id:"faqs"},"FAQs"),(0,n.kt)("h2",{id:"q1-how-does-hwameistor-scheduler-work-in-a-kubernetes-platform"},"Q1: How does HwameiStor scheduler work in a Kubernetes platform?"),(0,n.kt)("p",null,"The HwameiStor scheduler is deployed as a pod in the HwameiStor namespace."),(0,n.kt)("p",null,(0,n.kt)("img",{alt:"img",src:o(8841).Z,width:"553",height:"196"})),(0,n.kt)("p",null,"Once the applications (Deployment or StatefulSet) are created, the pod will be scheduled to the worker nodes on which HwameiStor is already configured."),(0,n.kt)("h2",{id:"q2-how-does-hwameistor-schedule-applications-with-multi-replicas-workloads-and-what-are-the-differences-compared-to-the-traditional-shared-storage-nfs--block"},"Q2: How does HwameiStor schedule applications with multi-replicas workloads and what are the differences compared to the traditional shared storage (NFS / block)?"),(0,n.kt)("p",null,"We strongly recommend using StatefulSet for applications with multi-replica workloads."),(0,n.kt)("p",null,"StatefulSet will deploy replicas on the same worker node with the original pod, and will also create a PV data volume for each replica. If you need to deploy replicas on different worker nodes, you shall manually configure them with ",(0,n.kt)("inlineCode",{parentName:"p"},"pod affinity"),"."),(0,n.kt)("p",null,(0,n.kt)("img",{alt:"img",src:o(2933).Z,width:"1382",height:"426"})),(0,n.kt)("p",null,"We suggest using a single pod for deployment because the block data volumes can not be shared."),(0,n.kt)("h2",{id:"q3-how-to-maintain-a-kubernetes-node"},"Q3: How to maintain a Kubernetes node?"),(0,n.kt)("p",null,"HwameiStor provides the volume eviction/migration functions to keep the Pods and HwameiStor volumes' data running when retiring/rebooting a node."),(0,n.kt)("h3",{id:"retire-a-node"},"Retire a node"),(0,n.kt)("p",null,"Before remove a node from a Kubernetes cluster, the Pods and volumes on the node should be rescheduled and migrated to another available node, and keep the Pods/volumes running."),(0,n.kt)("p",null,"Follow these steps to retire a node:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre"},"## Step 1:\n\n$ kubectl drain NODE --ignore-daemonsets=true. --ignore-daemonsets=true\n")),(0,n.kt)("p",null,"Allows the above command to succeed even if pods managed by daemonset exist.\nIf it stacks due to PodDisruptionBudgets or something, try --force option.\nThe command will also trigger HwameiStor to migrate all the volumes' replicas to another available node. Make sure the migration to complete by following command before moving ahead."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre"},"## Step 2:\n\n$ kubectl get localstoragenode NODE\napiVersion: hwameistor.io/v1alpha1\nkind: LocalStorageNode\nmetadata:\n  name: NODE\nspec:\n  hostname: NODE\n  storageIP: 10.6.113.22\n  topogoly:\n    region: default\n    zone: default\nstatus:\n  ...\n  pools:\n    LocalStorage_PoolHDD:\n      class: HDD\n      disks:\n      - capacityBytes: 17175674880\n        devPath: /dev/sdb\n        state: InUse\n        type: HDD\n      freeCapacityBytes: 16101933056\n      freeVolumeCount: 999\n      name: LocalStorage_PoolHDD\n      totalCapacityBytes: 17175674880\n      totalVolumeCount: 1000\n      type: REGULAR\n      usedCapacityBytes: 1073741824\n      usedVolumeCount: 1\n      volumeCapacityBytesLimit: 17175674880\n    ## **** make sure volumes is empty **** ##\n      volumes:  \n  state: Ready\n")),(0,n.kt)("p",null,"At the same time, HwameiStor will automatically reschedule the evicted Pods to the other node which has the associated volume' replica, and continue to run."),(0,n.kt)("p",null,"Run the following command to remove the NODE from the cluster."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre"},"## Step 3:\n$ kubectl delete nodes NODE\n")),(0,n.kt)("h3",{id:"reboot-a-node"},"Reboot a node"),(0,n.kt)("p",null,"It ususally takes a long time (~10mins) to reboot a node. All the Pods and volumes on the node will not work until the node is back online. For some applications like DataBase, the long downtime is very costly and even unacceptable."),(0,n.kt)("p",null,"HwameiStor can immediately reschedule the Pod to another available node with associated volume data and bring the Pod back to running in very short time (~ 10 seconds for the Pod using a HA volume, and longer time for the Pod with non-HA volume depends on the data size)."),(0,n.kt)("p",null,"To reboot a node, the step 1 and 2 are same as above (in section of ",(0,n.kt)("inlineCode",{parentName:"p"},"Retire a node"),").\nAfter the success of step 1 and 2, reboot the node and waiting for the node to be back online. And then"),(0,n.kt)("p",null,"Run step 3 to bring the node back to normal"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre"},"## Step 3:\n$ kubectl uncordon NODE\n")),(0,n.kt)("h3",{id:"for-the-traditional-shared-storage"},"For the traditional shared storage:"),(0,n.kt)("p",null,"StatefulSet will deploy replicas to other worker nodes for workload distribution and will also create a PV data volume for each replica."),(0,n.kt)("p",null,"The ",(0,n.kt)("inlineCode",{parentName:"p"},"Deployment")," will also deploy replicas to other worker nodes for workload distribution but will share the same PV data volume (only for NFS). We suggest using a single pod for block storage because the block data volumes can not be shared."))}u.isMDXComponent=!0},8841:(e,t,o)=>{o.d(t,{Z:()=>a});const a=o.p+"assets/images/clip_image002-ab1b7f5938d19fde9eee9c8e334a392e.png"},2933:(e,t,o)=>{o.d(t,{Z:()=>a});const a=o.p+"assets/images/clip_image004-ea219969be0d9d975904a119d3135ff1.png"}}]);